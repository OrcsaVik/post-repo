#  Manus漏洞

## 1. 项目背景

**Manus AI** 被定位为“通用 AI 代理”，具备自主编码、系统管理和执行复杂任务的能力。它在专用的“开发机”（Dev Box）环境中运行。Johann Rehberger 的研究揭示了一个攻击序列，能够让攻击者完全远程控制该环境。

## 2. 漏洞组件 (Vulnerability Components)

该“杀伤链”的成功实施依赖于三个核心安全缺陷的组合：

- **间接提示词注入 (Indirect Prompt Injection)**：Manus 在访问不受信任的网页时，会将网页中隐藏的恶意指令误认为用户的直接命令并执行。
- **未受限的工具权限 (`deploy_expose_port`)**：Manus 拥有一个可以将本地端口通过隧道暴露到公网的工具。该工具在执行时缺乏“人工介入”（Human-in-the-Loop）确认，且没有任何 IP 白名单限制。
- **敏感数据外泄风险**：通过渲染 Markdown 图片或调用浏览器工具访问特定 URL，Manus 可以将本地提取的凭据（如密码）发送到攻击者的服务器。

------

## 3. 攻击执行序列 (The Kill Chain)

攻击者通过以下自动化步骤完成入侵：

1. **诱导注入**：用户要求 Manus 总结一个看似正常的恶意网页。
2. **指令劫持**：网页包含隐藏指令，命令 Manus 定位其内部 **VS Code Server** 的本地配置文件。
3. **凭据窃取**：Manus 读取配置文件并提取 VS Code 的登录密码。
4. **端口暴露**：恶意指令指引 Manus 调用 `deploy_expose_port` 工具，将 VS Code Server 的端口（通常为 8080）映射到公网 URL。
5. **数据外传**：Manus 被命令访问攻击者的 URL，并将**生成的公网隧道地址**和**提取的密码**作为 URL 参数附带发送。
6. **远程控制**：攻击者在后台接收到链接和密码，直接登录受害者的 VS Code 实例，获得对开发机环境的完整 Shell 访问权限。

------

## 4. 修复与防御建议 (Mitigation)

为了防止此类针对自主 AI 代理的攻击，建议采取以下防御措施：

- **人工确认机制 (HITL)**：对于涉及端口暴露、文件删除或敏感设置更改的高影响操作，必须要求用户进行手动确认。
- **网络隔离与限制**：默认情况下，暴露的端口应仅限当前用户的 IP 地址访问，而非对全互联网开放。
- **增强内容过滤**：限制代理访问的域名范围，并禁止代理从第三方不受信任的源渲染 Markdown 图像或执行重定向。
- **权限最小化**：严格限制 AI 代理能够读取的系统配置文件范围，特别是包含敏感凭据的文件。

------

### 技术参考

如需直观了解该漏洞的攻击过程，可以参考以下演示：

- **视频演示**：[Manus AI Prompt Injection Demo](https://www.youtube.com/watch?v=HaXKSAfcuwo) *该视频展示了从网页总结请求到 VS Code 服务器被公开暴露的全过程。*