---
title: Seta事务
---

# SETA事务

默认使用

XA 两阶段事务

AT（事务全局事务）



非常好 👍
 你现在已经抓住了 Seata 的核心结构：**TC / TM / RM** 三者的协作是分布式事务能否正确运行的关键。
 下面是它们之间的 **核心关系依据与交互机制**（建议你掌握到这个层次👇）。

------

## 🧩 一、三者角色逻辑关系总览

| 组件   | 全称                                  | 职责                                                       | 关键所在                     |
| ------ | ------------------------------------- | ---------------------------------------------------------- | ---------------------------- |
| **TC** | Transaction Coordinator（事务协调者） | 维护**全局事务状态**与**分支事务状态**，协调全局提交或回滚 | 分布式事务的“大脑”           |
| **TM** | Transaction Manager（事务管理器）     | 定义事务边界，负责**开启/提交/回滚**全局事务               | 向 TC 注册全局事务           |
| **RM** | Resource Manager（资源管理器）        | 控制具体数据库资源（如 MySQL），执行本地事务               | 向 TC 注册、报告分支事务状态 |

------

## 🔁 二、三者交互流程（全局事务生命周期）

以下是一个典型 **全局事务（Global Transaction）** 的调用流程（也是理解依据）：

### Step 1️⃣ TM 开启全局事务

- TM（事务管理器）在业务逻辑入口处（如 `@GlobalTransactional` 注解标记的方法）
   向 **TC** 发送：

  ```text
  Begin Global Transaction Request
  ```

- TC 创建一个全局事务 ID（`XID`），返回给 TM。

------

### Step 2️⃣ RM 注册分支事务

- TM 在业务调用链中传递 `XID`（例如跨多个微服务调用）。

- 每个微服务的 RM 在执行本地数据库操作前：

  - 向 **TC 注册**一个分支事务：

    ```text
    Branch Register Request (with XID)
    ```

  - 由 TC 记录下这个分支属于哪个全局事务。

------

### Step 3️⃣ RM 执行本地事务（Try 阶段）

- RM 执行本地 SQL 时，会先在 undo_log 表中记录 **反向补偿信息**（保证可回滚）。

------

### Step 4️⃣ TM 请求提交/回滚

- 当业务方法执行完毕：

  - 若成功 → TM 向 TC 发送：

    ```text
    Global Commit Request (XID)
    ```

  - 若异常 → TM 向 TC 发送：

    ```text
    Global Rollback Request (XID)
    ```

------

### Step 5️⃣ TC 驱动 RM 提交或回滚

- TC 根据上一步的请求，逐个通知各个分支的 RM：

  - 提交时：

    ```text
    Branch Commit Request
    ```

  - 回滚时：

    ```text
    Branch Rollback Request
    ```

- RM 执行实际数据库提交或反向补偿，然后报告状态回 TC。

------

## 📘 三、关系图示（核心理解结构）

```
            ┌──────────────┐
            │     TM       │
            │(事务管理器)   │
            └──────┬───────┘
                   │开启/提交/回滚
                   ▼
            ┌──────────────┐
            │     TC       │
            │(事务协调者)   │
            └──────┬───────┘
                   │协调/通知
          ┌────────┴────────┐
          ▼                 ▼
 ┌──────────────┐   ┌──────────────┐
 │     RM1      │   │     RM2      │
 │(资源管理器)   │   │(资源管理器)   │
 └──────────────┘   └──────────────┘
```

------

